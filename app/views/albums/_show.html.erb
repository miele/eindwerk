<%= javascript_include_tag "swfobject.js", "jquery.uploadify.v2.1.0.js" %>
<script type="text/javascript" charset="utf-8">
<%- session_key = Rails.application.config.session_options[:key] -%> 
$(document).ready(function() {
	
	$('#picture_upload').click(function(event){ 
		event.preventDefault();
	}); 
	
	$('#picture_upload').uploadify({
  	uploader : '/uploadify/uploadify.swf',
		cancelImg : '/uploadify/cancel.png',
		multi : true,
		auto : true,
  	script : '/pictures',
		onComplete : function(event, queueID, fileObj, response, data) { 
			var dat = eval('(' + response + ')');
			$.getScript(dat.upload);},
  	scriptData : {
	        '_http_accept': 'application/javascript',
					'format' : 'json',
	        '_method': 'post',
	        '<%= session_key %>' : encodeURIComponent('<%= u cookies[session_key] %>'),
	        'authenticity_token': encodeURIComponent('<%= u form_authenticity_token %>'),
					'album_id' : '<%= @album.id %>'
	      }
	});
	
	$('#picture_submit').click(function(event){ 
			event.preventDefault(); 
			$('#picture_upload').uploadifyUpload(); 
		});
		
}); 
</script>

